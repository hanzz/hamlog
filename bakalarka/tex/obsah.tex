\chapter{Úvod}

Tato bakaláøská  práce je rozdìlena do ¹esti kapitol.

\begin{enumerate}
  \item \textbf{Úvod} - Úvodní kapitola.
  \item \textbf{Radioamatéøi} - V druhé kapitole (\ref{radioamateri}) je popsána historie amatérského rádia
(\ref{radioamateri_hist}) a také jeho aktuální stav dnes (\ref{radioamateri_dnes}).
  \item \textbf{Rozbor zadání} - V tøetí kapitole ...
  \item \textbf{Návrh aplikace} - Ètvrtá kapitolá (\ref{navrh}) struènì popisuje návrh 
komunikaèního protokolu (\ref{navrh_protokol}), serverové aplikace (\ref{navrh_server}), klientské knihovny 
(\ref{navrh_knihovna}) a samotné klientské aplikace (\ref{navrh_klient}).
  \item \textbf{Implementace} - V páté kapitole (\ref{implementace}) je popsána implementace v¹ech souèástí
zmínìných v kapitole ètvrté (\ref{navrh}). V podkapitole o implementaci serverové aplikace (\ref{implementace_server})
je popsána implementace databázového rozhraní (\ref{implementace_db}), modulù (\ref{implementace_moduly}),
seznam implementovaných modulù (\ref{implementace_moduly_list}) a logování (\ref{implementace_logovani}). Dále je
zde popsána implementace klientské knihovny (\ref{implementace_knihovna}) a samotného klienta (\ref{implementace_klient}).
  \item \textbf{Závìr} - V ¹esté kapitole (\ref{zaver}) ...
\end{enumerate}

\chapter{Radioamatéøi}
\label{radioamateri}

V této kapitole je struènì popsána historie amatérského rádia a jsou zde vysvìtleny dùle¾ité pojmy pou¾ívané dále v práci.
Podkapitola \ref{radioamateri_hist} a \ref{radioamateri_dnes} byla pøevzata z \cite{crk_hist}.

\section{Historie amatérského rádia}
\label{radioamateri_hist}
Prvotní motivací pro vznik amatérského rádia byla my¹lenka na¹ich pøedkù rádio nejen poslouchat, ale také vysílat.
To dalo vzniknout novému druhu zábavy - amatérskému vysílání (HAM Radio). Lidem, kteøí vysílali se pak zaèalo øíkat 
radioamatéøi.

Amatérské rádio se zaèalo rychle ¹íøit po první svìtové válce hlavnì díky vlivu rozhlasu. V tìchto dobách radioamatéøi znaènì
pøispìli k získání znalostí o vyu¾ití celého spektra radiových vln. Vysílali na dlouhých a støedních vlnách, které byly do té doby
pova¾ovány za bezcenné, a také na vlnách krátkých, o jejich¾ existenci se nevìdìlo vùbec.

První pokusy o transatlantické spojení zaèaly lákat také Pravoslava Motyèku - prvního známého radioamatéra u nás.
Koncem roku 1924 navázal Motyèka první spojení v Èeskoslovensku. 
Díky Motyèkovì inspiraci bylo u nás kolem 30. let 20. století a¾ nìkolik set radioamatérù.

Dal¹ím významýn rokem byl rok 1928, kdy byl ruský radioamatér prvním, kdo zachytil volání vzducholodi ITALIA,
která ztroskotala na cestì od severního pólu. To zmìnilo pohled na amatérské rádio, do té doby vnímané spí¹e jako zábava ne¾
pøíli¹ u¾iteèná vìc. Pøi mnoha pohromách na celém svìtì èasto pomohla pøipravenost radioamatérù poskytnout rychlé spojení do
jiných míst.

\section{Amatérské rádio dnes}
\label{radioamateri_dnes}

Základním pilíøem amatérského rádia je vysílání na krátkých vlnách umo¾òují spojení do celého svìta vèetnì exotických zemí.
Øada radioamatérù se sna¾í a spojení s co nejvíce exotickými zemìmi. Této zálibì øíkáma DX provoz.
Po úspì¹nì navázaném spojení si radioamatéøi vymìnují QSL lístky (potvrzení o navázaném spojení formátu pohlednice). Cílem je
získání QSL lístkù z co mozná nejvíce zemí svìta (ideálnì v¹ech).

Pro kvalitní pøíjem profesionálního vysílání (napøíklad FM rozhlas nebo televize) je potøeba být od výsilaèe vzdálen maximálnì
v desitkách kilometrù. Radioamatéøi se pøi svých vysíláních sna¾í tyto limity pøekonat a provádìt spojení na co nejvìt¹í
vzdálenosti. K tomu vyu¾ívají kromì techniky také dobrých znalostí faktorù, které ovliòují ¹íøení krátkých vln. Tìmi jsou napøíklad
rozhraní teplých a studených mas vzduchu nebo polární záøe. Profesionálové se nemohou na tyto pøechodné faktory spolehnout, ale 
radioamatéøi jsou díky nim schopni navázat spojení a¾ na tisíce kilometrù

Na øadì vysokých budov a kopcù pracují pozemní radioamatérské pøevadìèe. Pøevadìè pøeposílá signál pøijatý na na jedné frekvenci
na frekvenci jinou. Radioamatéøi se tak mohou pomocí pøevadìèe dovolat na velké vzdálenosti i s pou¾itím vysílaèù o malém výkonu
(èasto jde o kapesní radiostanice)

V poèátcích 60. let byla také vypo¹tìna první radioamatérská dru¾ice. Dnes jich existuje nìkolik desítek.
Dru¾ice pokrývají, podobnì jako bì¾né televizní satelity, kruh o prùmìru zhruba 4000 km. 
Narozdíl od geostacionárních televizních satelitù v¹ak amatérské dru¾ice kolem Zemì obíhají.
Díky tomu jsou schopny pokrýt postupnì signálem v¹echny obydlené oblasti.

V radioamatérském vysílání se rovnì¾ konají závody. Cílem je napøíklad v urèitém èase navázat spojení s co nejvíce jinými
amatérskými stanicemi v co nejvíce zemích. Jinou variantou je napøíklad souèet vzdáleností v¹ech spojení vykonaných za urèitý
èas.

Morseova abeceda byla prvním dorozumívacím prostøedkem pou¾ívaným v amatérském rádiu a je radioamatéry pou¾ívána dodnes.
Hlavním pøínosem morseovy abecedy je její velká odolnost proti ru¹ení, diký ní¾ lze pøekonat velké vzdálenosti i s malým
výkonem. Dal¹í výhodou je to, ¾e odbourává jazykové bariéry, proto¾e se komunikuje pøevá¾nì pomocí zkratek. Pøi hlasové komunikaci
je mezinárodním jazykem angliètina a vyu¾ívá se amplitudové modulace SSB nebo FM modulace.

Nejnovìj¹ím systémem pro zakódování øeèi je je packet 
radio. V podstatì se jedná o radioamatérský Internet, kde se informace pøená¹í pomocí modifikace protokolu X.25. 
Sí» packet radia pokrývá celý vyspìlý svìt, její souèástí jsou i BBS (databanky pro ukládání a výmìnu informací) a
elektronická po¹ta. Poslat e-mail kamarádovi do Austrálie nemusíte jen po Internetu,
ale také amatérským packet radiem, a nemáte-li nic lep¹ího na práci, mù¾ete trávit hodiny zkoumáním nových zpráv i
zajímavých programù v desítkách BBS po celé Evropì.

Samozøejmì jde vysílat i obrazové signály. Dlouhou tradici má tzv. pomalá televise (SSTV),
jaká byla pou¾ita i u pøenosu obrazu z prvních pøistání amerických astronautù na Mìsíci,
dnes se experimentuje s rùznými digitálními pøenosy a na UHF kmitoètech je mo¾né pou¾ít i klasickou televisní normu.

Z ryze sportovních aktivit je dobøe známý rádiový
orientaèní bìh. Cílem je v nejkrat¹ím èase najít pomocí
pøijímaèe v terénu ukryté zamaskované vysílaèe. 
Tyto sporty jsou atraktivní a pìstují je i lidé, kteøí se jinak o radioamatérství pøíli¹ nezajímají.

\section{Dùle¾ité pojmy}
\label{radioamateri_pojmy}

V této podkapitole jsou popsány dùle¾ité pojmy pou¾ívané mezi radioamatéry, které jsou také pou¾ity dále v této práci.

\subsection{Volací znaèka}

Ka¾dá stanice má pøidìlenu jedineènou volací znaèku, kterou operátor stanice uvádí pøi ka¾dém spojení.
První dva znaky znaèky jsou urèeny podle pøehledu mezinárodních volacích znakù pøidìlených dané zemi.
Dal¹ím znakem je èíslo 0-9. Kombinaci tìchto tøí znakù se øíká prefix. Zbytek znaèky je tvoøen jedním a¾ ètyømi znaky.

Na základì prefixu tak lze urèit zemi, ze které daný operátor pochází a tak i jeho pøibli¾nou polohu. K tomu slou¾í seznam DXCC
obsahující v¹echny aktuálnì pou¾ívané prefixy a informace k nim.

\subsection{ITU zóny}

Jedním z mo¾ných rozdìlení svìta na men¹í celky je jeho rozdìlení do takzvaných ITU zón.
Systém je pojmenován podle organizace International Telecommunications Union. Svìt je rozdìlen do celkem 
89 zón ve tøech regionech.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.4]{fig/itu-zone.png}
\caption{Rozdìlení ITU zón.}
\label{fig:FigureExample}
\end{figure}

\subsection{CQ zóny}

Dal¹ím z mo¾ných rozdìlení svìta pou¾ívaných radioamatéry je dìlení na CQ zóny, pojmenované podle èasopisu CQ.
Jde o pouze 40 zón.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.4]{fig/cq-zone.png}
\caption{Rozdìlení CQ zón.}
\label{fig:FigureExample}
\end{figure}

\subsection{QTH lokátor}

Poslední z pou¾ívaných systémù pro rozdìlení svìta je QTH lokátor. Jde o rozdìlení na základì zemìpisné ¹íøky a délky.
Zemì je rozdìlena do obdélníkù o velikosti 1° x 2°.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.7]{fig/QTH_locator.png}
\caption{Mapa rozdìlení pomocí QTH lokátoru.}
\label{fig:FigureExample}
\end{figure}

\subsection{QTH lokátor}

\section{Slu¾by pou¾ívané radioamatéry}
\label{radioamateri_sluzby}

Díky roz¹iøování Internetu se zaèaly rozvíjet i slu¾by provozované radioamatéry pro dal¹í radioamatéry. V této podkapitole
jsou struènì popsány slu¾by, kterých je v aplikaci vyu¾ito a se kterými aplikace umí spolupracovat.

\subsection{DXCluster}

DXCluster je komunitní slu¾bou umo¾òující radioamatérovi informovat ostatní radioamatéry o tom, kdo aktuálnì vysílá. Kromì
volací znaèky se posílá i poloha a frekvence, na které radioamatér vysílá. Díky této slu¾bì tak lze jednodu¹eji navazovat
spojení. Protokol slu¾by DXCluster je postaven na slu¾bì telnet a není nikterak slo¾itý. Lze jej jednodu¹e èíst a zpracovávat.

\subsection{QRZ.com}

QRZ.com je nejvìt¹í databází radioamatérù z celého svìta. Na základì volací znaèky lze s její pomocí zjistit rùzné detailní
informace (napøíklad jméno nebo pøesnou polohu) o jejím majiteli. Vyhledávat lze i pomocí speciálního webového rozhraní
postaveného na technologii XML. To je velmi výhodné pro tvorbu aplikací vyu¾ívajících QRZ.com pro zji¹tìní informací o
operátorech. XML rozhraní umo¾òuje pøihlásit se ke slu¾bì QRZ.com a provést vyhledání na základì volací znaèky.

\chapter{Souèasné logovací aplikace}
\label{soucasnost}

V této kapitole jsou posány aplikace pou¾ívané souèasnými radioamatéry pro logování spojení. Ka¾dá aplikace je struènì
popsána a jsou zmínìny i její klady a zápory. Na základì této kapitoly bude vytvoøen základní návrh aplikace.

\section{Logger32}

Logger32 je jednou z nejznámìj¹ích logovacích aplikací pro operaèní systém Windows. Jeho hlavní výhodou je pøehledné a funkèní
u¾ivatelské rozhraní rozhraní a podpora pøídavných pluginù.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.33]{fig/logger32.jpg}
\caption{U¾ivatelské rozhraní Logger32.}
\label{fig:FigureExample}
\end{figure}

Lze vytváøet pluginy pro vyhledávání detailních informací na základì volací znaèky a také pluginy vytváøející externí okno
s informacemi roz¹iøující informace. Logger32 také umo¾òuje ovládání radiostanice.

Hlavní nevýhodou aplikace Logger32 je její závislost na systému Windows. Moderním trendem dne¹ní doby je programování multiplatformních
aplikací. Dal¹í nevýhodou je absence zdrojových kódù, tak¾e je roz¹íøitelnost aplikace limitována rozhraním modulù definovaným
tvùrcem aplikace.
Mezi nevýhody mù¾eme øadit také nemo¾nost pou¾ití externí databáze jako je napøíklad SQLite3 nebo MySQL. Problémem mù¾e rovnì¾ být
situace, kdy chce u¾ivatel zalogovat nové spojení z mobilního telefonu nebo jiného zaøízení s nestandardním operaèním systémem. V
dne¹ní dobì je dùle¾itým faktorem pøi tvorbì aplikací dùraz na jejich pou¾itelnost na ¹irokém poètu zaøízení.

\section{CQRLOG}

CQRLOG je nejpou¾ívanìj¹ím logovacím nástrojem z øad multiplatformních aplikací. Je mo¾né jej pou¾ívat jak v systému
Windows, tak v Linuxových distribucích.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.5]{fig/cqrlog.png}
\caption{U¾ivatelské rozhraní CQRLOG.}
\label{fig:FigureExample}
\end{figure}

Jeho u¾ivatelské rozhraní je jednodu¹¹í ne¾ rozhraní programu Logger32 a je také více pøehledné. Na druhou stranu v¹ak
chybí podpora roz¹íøení formou pluginù. K dispozici jsou zdrojové kódy v jazyce Delphi. Volba tohoto programovacího jazyka
znaènì ztì¾uje (a¾ znemo¾òuje) tvorbu oficiálních instalaèních balièkù pro linuxové distribuce.

CQRLOG umo¾òuje pou¾ítí
MySQL databáze, ale návrh aplikace znemo¾òuje jednoduchou zmìnu databázové aplikace. Také volba MySQL databáze pro pou¾ití 
v desktopové aplikaci mù¾e být vnímána jako negativum. Návrh CQRLOGu rovnì¾ nedefinuje rozhraní pro jednoduché pøidávání nebo úpravu
záznamù pomocí aplikací tøetích stran a není tak jednoduché postavit dal¹í aplikaci nad CQRLOGem.

\section{HAM Radio Deluxe}

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.33]{fig/hrd.jpg}
\caption{U¾ivatelské rozhraní HAM Radio Deluxe.}
\label{fig:FigureExample}
\end{figure}

\chapter{Návrh aplikace}
\label{navrh}

Cílem této kapitoly je popsání návrhu aplikace a pou¾itého komunikaèního protokolu.

Na základì rozboru souèasnì pou¾ívaných aplikací z pøedchozí kapitoly vyplynuly základní po¾adavky
na výslednou aplikaci.

\begin{itemize}
\item \textbf{Multiplatformnost} - Návrh aplikace musí poèítat s mo¾ností jejího spou¹tìní na rùzných operaèních systémech
a platformách.
\item \textbf{Klient-server architektura} - Jádro programu je tvoøeno serverem.
Server umo¾òuje vedení deníkù více u¾ivatelù zároveò a poskytuje rozhraní pro pøídavné moduly.
Klientská aplikace se pøipojí k serveru a prostøedníctvím komunikaèního protokolu s ním komunikuje.
Díky tomuto rozdìlení je mo¾né pøidávat záznamy do centrální databáze z více zaøízení a pracovat
tak v¹ude se stejnými daty. Vyu¾ití klient-server architektury je výhodné také pro soutì¾e, kdy mù¾e vyhodnocení
výsledkù v¹ech úèastníkù probìhnout souèasnì na centrálním místì.
\item \textbf{Modulárnost} - Serverová aplikace je zalo¾ena na modulech. Moduly jsou speciální knihovny roz¹iøující funkce
serveru. Moduly umí zpracovávat klientské po¾adavky a je jim umo¾nìn pøístup k deníkùm jednotlivých u¾ivatelù. Díky pou¾ití modulù
je zaji¹tìna jednoduchá roz¹íritelnost aplikace o nové funkce bez nutnosti zmìny jejího jádra.
\item \textbf{Ulo¾ení dat} - Záznamy jednotlivých u¾ivatelù jsou ulo¾eny v databázi SQLite3. Návrh aplikace
v¹ak poèítá s mo¾ností pou¾ití rùzných formátù pro ulo¾ení u¾ivatelských dat.
\item \textbf{Oddìlení grafického rozhraní od komunikace se serverem} - Klientská aplikace vyu¾ívající grafického rozhraní
je oddìlena od nízkoúrovòové komunikace se serverem díky klientské knihovnì. Klientská knihovna obsahuje základní funkce
pro komunikaci se serverem a umo¾òuje pou¾ití libovolného grafického rozhraní bez zbyteèné duplikace kódu.
\end{itemize}

Aplikace se tedy skládá z modulárního serveru, klientské knihovny a grafického u¾ivatelského rozhraní.
V následujících podkapitolách jsou jednotlivé èásti struènì popsány.

\begin{figure}[h]
\centering
\includegraphics[trim=12cm 12cm 12cm 12cm, scale=0.8]{fig/princip.pdf}
\caption{Základní èinnost programu.}
\label{fig:FigureExample}
\end{figure}

\newpage
\section{Návrh komunikaèního protokolu}
\label{navrh_protokol}

Byl zvolen protokol inspirovaný protokolem HTTP \cite{http}, pøevá¾nì kvùli jeho jednoduchosti a úèelnosti z hlediska modularity.
Jednotlivé moduly serveru mají své vlastní URI a klientské po¾adavky jsou pak smìrovány podle URI na konkrétní modul,
který vygeneruje odpovìï poslanou klientovi.

Protokol je zpìtnì kompatibilní s protokolem HTTP, ale jsou pou¾ity jen nìkteré jeho èásti. Komunikace probíhá v re¾imu
po¾adavek-odpovìï.

Data pøená¹ená protokolem HTTP jsou ve formátu CSV \cite{csv}, kde první øádek reprezentuje hlavièku dat. Standardní názvy
sloupcù ve hlavièce protokolu jsou:
\begin{itemize}
\item \textbf{id} - ID záznamu v logu. Koresponduje s ID v databázi a slou¾í jako klíè pro vybrání konkrétního øádku.
\item \textbf{user\_id} - ID u¾ivatele, jemu¾ záznam v logu patøí.
\item \textbf{qsodate} - Datum záznamu ve formátu unixového timestampu.
\item \textbf{callsign} - Volací znaèka (napøíklad OK2JRQ).
\item \textbf{mode} - Mód spojení.
\item \textbf{qth} - QTH lokátor (Maidenhead Locator).
\item \textbf{name} - Jméno operátora.
\item \textbf{latitude} - Zemìpisná ¹íøka.
\item \textbf{longitude} - Zemìpisná délka.
\item \textbf{conty} - Okres.
\item \textbf{continent} - Zkratka kontinentu.
\item \textbf{cq} - CQ zóna.
\item \textbf{itu} - ITU zóna.
\end{itemize}

Jednotlivé moduly serveru v¹ak mohou pou¾ít i své vlastní názvy sloupcù pro polo¾ky, které nejsou v tomto seznamu.

\subsection{Ukázky pou¾ití protokolu}

\subsubsection{Vy¾ádání logu}

Tento pøíklad ukazuje pou¾ití protokolu pro získání v¹ech záznamù z logu.

Dotaz na modul poskytující URI "/logbook":
\begin{verbatim}
GET /logbook HTTP/1.1


\end{verbatim}
Odpovìï serveru:
\begin{verbatim}
HTTP/1.1 200 OK
Content-Type: text/hamlog
Content-Length: 74

id;user_id;callsign;date;qth;loc
1;1;TEST;2011;qt;
2;1;LKS;2011;;location
\end{verbatim}

\subsubsection{Editace záznamu}

TODO

Dotaz na modul poskytující URI "/logbook":
\begin{verbatim}
GET /logbook HTTP/1.1


\end{verbatim}
Odpovìï serveru:
\begin{verbatim}
HTTP/1.1 200 OK
Content-Type: text/hamlog
Content-Length: 74

id;user_id;callsign;date;qth;loc
1;1;TEST;2011;qt;
2;1;LKS;2011;;location
\end{verbatim}

\subsection{Pøihlá¹ení u¾ivatele}

Pøihlá¹ení je provádìno metodou Digest Access Authentication definovanou v RFC 2617 \cite{rfc2617}. Díky tomu se heslo neposílá
pøi pøihlá¹ení po síti a je mo¾né jej na stranì serveru ukládat zahashované. Nehrozí tak jeho mo¾ný odposlech bìhem pøihlá¹ení.

\subsubsection{Ukázka pøihlá¹ení u¾ivatele}

Dotaz na modul poskytující URI "/login":
\begin{verbatim}
GET /login HTTP/1.1

\end{verbatim}

Odpovìï serveru vybízí u¾ivatele k pøihlá¹ení podle RFC 2617 \cite{rfc2617}:
\begin{verbatim}
HTTP/1.0 401 Unauthorized
Content-Type: text/html
Content-Length: 14
WWW-Authenticate: Digest realm="realm@hamlog",qop="auth,auth-int",nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",opaque="5ccc069c403ebaf9f0171e9517f40e41"

Authentication
\end{verbatim}

Klient se pøihlásí s pou¾itím správného jména a hesla, které je v¹ask pøená¹ena zahashované:
\begin{verbatim}
GET /login HTTP/1.1
Authorization: Digest username="ok2jrq",realm="realm@hamlog",nonce="dcd98b7102dd2f0e8b11d0f600bfb0c093",uri="/login",qop=auth,response="d197141dc972c02d71e6a73b3396ed53",opaque="5ccc069c403ebaf9f0171e9517f40e41")

\end{verbatim}

Server informuje klienta o úspì¹ném pøihlá¹ení:
\begin{verbatim}
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 10

Authorized
\end{verbatim}

\section{Návrh serveru}
\label{navrh_server}

Server je konzolová aplikace zpracovávající klientské po¾adavky. Administrátor mù¾e server konfigurovat konfiguraèním souborem
v INI formát. Server je schopen obsluhovat více u¾ivatelù souèasnì.
U¾ivatelé se k serveru pøihla¹ují pomocí jména a hesla. Noví u¾ivatelé se musí nejprve registrovat.

Návrh serveru poèítá s pou¾itím jakékoliv databáze pro uchování perzistentních dat. V rámci této bakaláøské práce jsem se 
rozhodl pou¾ít databázi SQLite3.

Server je modulární a ve¹keré slu¾by, které u¾ivateli poskytuje, jsou souèástí modulù. Server samotný pouze spravuje
pøipojené u¾ivatele a deleguje po¾adavky na jednotlivé moduly.

\subsection{Moduly}
\label{navrh_moduly}

Moduly umo¾òují dynamicky roz¹iøovat funkènost serveru. Ka¾dý nový po¾adavek, který server od klienta pøijme je
pøedán pøíslu¹nému modulu na základì URI. Modul jej zpracuje a ode¹le klientovi zpìt odpovìï. Klient si mù¾e
od serveru vy¾ádat seznam v¹ech modulù pomocí po¾adavku na speciální URI "/modules".

Modulùm je také umo¾nìno pøistupovat k databázi záznamù v¹ech u¾ivatelù a provádìt nad ní dotazy. Tato problematika je více
rozebrána v následující podkapitole.

\begin{figure}[h]
\centering
\includegraphics[trim=11cm 11cm 11cm 11cm, scale=0.7]{fig/navrh_moduly.pdf}
\caption{Návrh vyu¾ití modulù.}
\label{fig:FigureExample}
\end{figure}

Jednotlivé moduly serveru jsou navr¾eny jako dynamické knihovny.
Pøi spu¹tìní serveru jsou nahrány v¹echny moduly z adresáøe nastavitelného pomocí konfiguraèního souboru.

Ka¾dý modul obsahuje následující informace:

\begin{itemize}
\item \textbf{URI} - URI modulu, na kterém daný modul pracuje. Ka¾dý modul serveru musí mít své jedineèné URI.
\item \textbf{Typ} - Typ modulu. V¹echny moduly daného typu poskytují stejné komunikaèní rozhraní. To umo¾òuje klientské knihovnì
komunikovat i s pro ni neznámými moduly pouze na základì znalosti jejich typu.
\item \textbf{Popis} - Krátký text popisující funkci modulu. V grafickém rozhraní je tento text zobrazen v seznamu modulù.
\end{itemize}

V rámci této bakaláøské práce existují moduly jen dvou typù:

\begin{itemize}
\item \textbf{CALLINFO} - Moduly tohoto typu poskytují rozlièné informace (napøíklad polohu nebo jméno operátora)
na základì volací znaèky. Data jsou získávána z veøejnì dostupných slu¾eb, nebo z databáze ulo¾ené na serveru.
\item \textbf{DXCLUSTER} - Moduly typu DXCLUSTER poskytují informace (napøíklad frekvenci a polohu) o stanicích,
které aktuálnì vysílají.
\end{itemize}

\subsubsection{Rozhraní modulù typu CALLINFO}

S moduly typu CALLINFO lze komunikovat následujícími zpùsoby:

\begin{itemize}
\item \textbf{Po¾adavek typu POST na URI "/modul"} - Jako data je v po¾adavku zaslána volací znaèka operátora. Odpovìï obsahuje
ve¹keré zjistitelné informace o volací znaèce ve formátu CSV definovaném v podkapitole \ref{navrh_protokol}.
\item \textbf{Po¾adavek typu GET na URI "/modul/username"} - Pokud modul vy¾aduje registraci u¾ivatelského jména a hesla pro
pøístup k databázi volacích znaèek (napøíklad v pøípadì, ¾e modul pøistupuje ke slu¾bì, která je jen pro registrované), musí modul
implementovat zpracování tohoto URI a vrátit aktuálnì registrované u¾ivatelské jméno nebo prázdný øetezec. Klient pak mù¾e tohoto
chování vyu¾ít pro zji¹tení, jestli je potøeba být pro pou¾ití modulu registrován.
\item \textbf{Po¾adavek na URI "/modul/register"} - Slou¾í k registraci u¾ivatelského jména a hesla pro pou¾ití modulu.
Jméno a heslo jsou pøedány v hlavièce paketu pod klíèi "username" a "password".
\end{itemize}

\subsubsection{Rozhraní modulù typu DXCLUSTER}

Moduly typu DXCLUSTER poskytují následující funkce:

\begin{itemize}
\item \textbf{Po¾adavek typu GET na URI "/modul"} - Modul vrátí seznam novì vysílajících stanic od posledního dotazu. Klient se tak
musí opakovanì ptát, aby získal nové vysílající stanice.
\item \textbf{Po¾adavek typu GET na URI "/modul/username"} - Význam je stejný jako u modulu typu CALLINFO.
\item \textbf{Po¾adavek na URI "/modul/register"} - Význam je stejný jako u modulu typu CALLINFO.
\end{itemize}

\subsection{Databáze}
\label{navrh_databaze}

Souèástí serveru je rozhraní pro pøístup k databázi. Ve¹kerá data v¹ech u¾ivatelù jsou v této databázi ulo¾ena.
Návrh serveru poèítá s vyu¾itím databáze jakéhokoliv typu (SQLite3, MySQL, PostgreSQL, \dots). Jednotlivé moduly
umí prostøednictvím databázového rozhraní s databází pracovat a spou¹tìt nad ní prakticky jakékoliv dotazy.

Na následujícím obrázku je zobrazeno obecné schéma databáze pou¾ité pro ulo¾ení v¹ech potøebných informací. Tabulky
z tohoto obrázku jsou pak dále struènì popsány.

\begin{figure}[h]
\centering
\includegraphics[trim=9cm 9cm 9cm 9cm, scale=0.7]{fig/navrh_databaze.pdf}
\caption{Návrh databáze.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tabulka users}

Tabulka users obsahuje informace potøebné pro pøihlá¹ení u¾ivatele deníku. Jde zejména o jeho volací znaèku a
heslo.

\subsubsection{Tabulka logbook}

V tabulce logbook jsou ulo¾eny deníky v¹ech u¾ivatelù. Obsahuje následující sloupce:

\begin{itemize}
\item \textbf{id} - ID záznamu v logu.
\item \textbf{user\_id} - ID u¾ivatele, jemu¾ záznam v logu patøí.
\item \textbf{qsodate} - Datum záznamu ve formátu unixového timestampu.
\item \textbf{callsign} - Volací znaèka (napøíklad OK2JRQ).
\item \textbf{mode} - Mód spojení.
\item \textbf{qth} - QTH lokátor (Maidenhead Locator).
\item \textbf{name} - Jméno operátora.
\item \textbf{latitude} - Zemìpisná ¹íøka.
\item \textbf{longitude} - Zemìpisná délka.
\item \textbf{conty} - Okres.
\item \textbf{continent} - Zkratka kontinentu.
\item \textbf{cq} - CQ zóna.
\item \textbf{itu} - ITU zóna.
\item \textbf{qsl} - Pøíznak ¾ádosti o QSL lístek.
\item \textbf{qsl\_sent} - Pøíznak poslání QSL lístku.
\item \textbf{comments} - Komentáøe.
\end{itemize}

\section{Klientská knihovna}
\label{navrh_knihovna}

Cílem klientské knihovny je poskytnout grafickému rozhraní jednotné API pro pøístup k serveru
a tím pádem zamezit duplikování kódu mezi pøípadnými grafickými rozhraními.

Klientská knihovna má minimální závislosti a je multiplatformní. Pomocí komunikaèního protokolu
komunikuje se server, zpracovává pøíchozí data a pøedává je klientovi.

Knihovna je navr¾ena tak, aby mohla spolupracovat s jakýmkoliv grafickým rozhraním.

Základními funkcemi klientské knihovny je:

\begin{itemize}
\item Pøipojení k serveru, registrace a pøihlá¹ení u¾ivatele.
\item Generování po¾adavkù pro server a jejich posílání.
\item Zpracování odpovìdí serveru a pøedání zpracovaných dat klientské knihovnì.
\end{itemize}

\section{Klient}
\label{navrh_klient}

Klient slou¾í koncovému u¾ivateli k pøipojení k serveru, prezentaci aktuálních dat a jejich zmìnì. Pro komunikace
se serverem klient vyu¾ívá klientskou knihovnu. Pro komunikaci s u¾ivatelem pak klient vyu¾ívá grafického rozhraní.
Po startu klienta je u¾ivatel vyzván k pøihlá¹ení se k serveru. U¾ivateli je rovnì¾ nabídnuta mo¾nost registrace
nového úètu.

Po pøihlá¹ení zobrazí klientská aplikace ve¹keré záznamy v deníku a umo¾ní jejich editaci. Klientská aplikace také zobrazuje
aktuální vysílání získané ze slu¾by DXCluster. Stanice, které aktuálnì vysílají jsou zobrazeny graficky na modelu zemìkoule.

Po vybrání stanice zobrazen dialog pro pøidání nového záznamu s pøedvolenými hodnotami získanými ze slu¾by DXCluster. Automaticky
je také pøeladìno rádio na danou frekvenci. V oknì pro nový záznam je u¾ivateli zobrazena historie v¹ech spojení s daným operátorem.
Po potvrzení dialogu je nový záznam odeslán na server a ulo¾en do databáze.

Klient také umo¾òuje zobrazit v¹echny moduly dostupné na serveru a jejich popis.


\chapter{Implementace}
\label{implementace}

V této kapitole je popsána implementace serverové aplikace, klientské aplikace a klientské knihovny.

\section{Implementace serverové aplikace}
\label{implementace_server}

Server byl implementován v jazyce C++ umo¾òujícím lep¹í dekompozici aplikace a pou¾ití objektového paradigmatu. Byla rovnì¾
pou¾ita knihovna Boost, která poskytuje základní metody pro asynchronní sí»ovou komunikaci a nabízí programátorské prostøedky
nad rámec standardní STL knihovny.

Pro implementaci modulu QRZ bylo potøeba pou¾ít knihovnu pro zpracování XML. K tomuto úèelu jsem pou¾il knihovnu TinyXML.

V této podkapitole jsou popsány nejdùle¾itej¹í tøídy serveru.

\subsubsection{Tøída Server}

Tøída Server je základní tøídou serveru. Vytváøí soket, na kterém server pøijímá pøipojení z klientské knihovny. Jakmile je 
akceptováno nové pøipojení, je vytvoøena instance tøídy Session, která dále zpracovává v¹echny po¾adavky klienta.

\subsubsection{Tøída Session}

Tato tøída reprezentuje sezení jednoho u¾ivatele. Pøi obdr¾ení nových dat od klienta jsou tato pøedána instanci tøídy
RequestParser, která slou¾í k jejich rozparsování. Pokud byla obdr¾ena kompletní zpráva, je pøedána instanci tøídy 
ModuleManager metodou handleRequest, která pak øídí její dal¹í zpracování. Výsledná odpovìï je pak tøídou Session poslána
zpìt klientovi.

\subsubsection{Tøída RequestParser}

Tøída RequestParser reprezentuje koneèný automat pro parsování zpráv podle specifikace komunikaèního protokolu.
Metoda parse zpracovává pøijatá data, parsuje je, a výsledek uchovává v instanci tøídy Request. Pokud dojde bìhem parsování
k chybì, vrací funkce parse hodnotu false a u¾ivatel, jeho¾ klient poslal nevalidní data, je odpojen.

\subsection{Implementace databázového rozhraní}
\label{implementace_db}

Návrh a implementace serveru umo¾òuje pou¾ití libovolného databázového rozhraní. V rámci bakaláøské práce je v¹ak podpována
pouze databáze SQLite3. Tøída implementující konkrétní databázové rozhraní musí dìdit tøídu StorageBackend a implementovat
její èistì virtuální metody.

\begin{figure}[h]
\centering
\includegraphics[trim=12cm 12cm 12cm 12cm, scale=0.7]{fig/imp_databaze.pdf}
\caption{Diagram databázového rozhraní.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tøída StorageBackend}

Tøída StorageBackend je základní abstraktní tøídou pro implementaci jakéhokoliv databázového rozhraní.
Je u ní pou¾it návrhový vzor Singleton a jejím smyslem je poskytnout rozhraní pro získávání dat z databázového rozhraní bez znalosti
o jakou databázi se jedná. Názvy metod a podtøíd jsou pojmenovány terminologií známou z SQL databází, ale prakticky
lze pomocí tøídy StorageBackend implementovat rozhraní pro pøístup k jakémukoliv typu databáze.

Tøída StorageBackend Obsahuje základní podtøídy pro definici dotazù typu SELECT, INSERT, UPDATE a CREATE známých z
jazyka SQL:

\begin{itemize}
\item StorageBackend::Column - Obsahuje ve¹keré informace o sloupci tabulky (jméno, typ, velikost,
pøíznaky pro NOT NULL, UNIQUE a PRIMARY KEY). Slou¾í pro definici sloupce pøi vytváøení
nové tabulky metodou StorageBackend::createTable().
\item StorageBackend::Select - Zapouzdøuje data potøebná pro provedení výbìru dat z databáze. Obsahuje jméno tabulky,
ze které se výbìr provádí, a ukazatel na dvourozmìrnì pole, do kterého se ulo¾í výsledky. Dále umo¾òuje tøída StorageBackend::Select
definovat omezení výbìru (v SQL jazyce klíèové slovo WHERE) a umo¾òuje výbìr konkrétních sloupcù, které vrátí ve výsledku.
Instance této tøídy je pøedána metodì StorageBackend::select() nebo StorageBackend::remove().
\item StorageBackend::Insert - Obsahuje data pro vlo¾ení (v SQL jazyce INSERT) nebo aktualizaci (v SQL jazyce UPDATE)
záznamu v databázi. Obsahuje název tabulky, ve které se budou data mìnit, a samotná data ve formì název sloupce - hodnota.
Umo¾òuje definovat omezení (v SQL jazyce WHERE) aplikovaná pøi aktualizaci dat. Instance této tøidy je pøedána metodì
StorageBackend::insert() nebo StorageBackend::update().
\end{itemize}

V závislosti na implementaci metod tøídy StorageBackend v nìktéré z jejich dceøiných tøíd je pak vyvolána konkrétní zmìna v
databázi. Tøída StorageBackend dále umo¾òuje získání identifikaèního èísla naposledy vlo¾eného záznamu metodou lastInsertedID().


\subsubsection{Tøída SQLite3Backend}

Tato tøída dìdí tøídu StorageBackend a implementuje její metody pro pou¾ití databázového systému SQLite3. V metodách
update(), insert(), select(), createTable() a remove() se na základì pøedaných dat vygeneruje dotaz v SQL jazyce, spustí se
a je vrácen výsledek.

\subsection{Implementace modulù}
\label{implementace_moduly}

Moduly jsou implementovány jako dynamické knihovny. Ka¾dý modul musí dìdit tøídu Modul (zprostøedkovanì napøíklad pøes tøídu RequestResponder)
a implementovat její èistì virtuální
(pure virtual) metody. Ve¹keré klientské po¾adavky jsou pak smìrovány na konkrétní modul podle URI instancí tøídy ModuleManager.

\begin{figure}[h]
\centering
\includegraphics[trim=10cm 10cm 10cm 10cm, scale=0.7]{fig/moduly.pdf}
\caption{Diagram tøíd modulù.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tøída Module}

Tøída Module poskytuje základní tøídu, kterou musí implementovat ka¾dý externí modul. Obsahuje základní informace o modulu 
(jeho jméno, typ a popis).

\subsubsection{Tøída RequestResponder}

Tato tøída dìdí tøídu Module a roz¹iøuje ji o data a metody specifické pro modul odpovídající na klientské po¾adavky.
Pøiøazuje modulu jeho URI a informaci o tom, jestli musí být u¾ivatel pro jeho pou¾ití pøihlá¹en.
Obsahuje také deklaraci metody handleRequest(), která je volána instancí tøídy ModuleManager pro ka¾dý pøíchozí po¾adavek
smeøující na modul.

\subsubsection{Tøída ModuleManager}

U tøídy ModuleManager je pou¾it návrhový vzor Singleton.
Tato tøída zabezpeèuje ve¹kerou práci serveru s externími moduly. Pomocí 
metody loadModules lze naèíst v¹echny moduly z adresáøe zvoleného v konfiguraèním souboru. Ve¹keré po¾adavky od klientù
jsou pøedány instanci této tøídy metodou handleRequest, která je pak dále smìruje podle URI na konkrétní modul. Tøída také
umo¾òuje poslat seznam v¹ech modulù klientské aplikaci.

\subsection{Seznam implementovaných modulù}
\label{implementace_moduly_list}

V této podkapitole jsou popsány jednotlivé implementované moduly.

\subsubsection{Modul Register}

Modul Register (bì¾ící na URI "/register") slou¾í k registraci nových u¾ivatelù. Pøi svém spu¹tìní vytvoøí pomocí
instance tøídy StorageBackend tabulku "users". V metodì handleRequest pak pøijímá pøípadné po¾adavky na registraci
u¾ivatele a pøidá nového u¾ivatele do databáze. Pokud je ji¾ u¾ivatel zaregistrován, vrací klientské aplikaci chybový kód.

\subsubsection{Modul Login}

Modul Login bì¾í na URI "/login". Jeho cílem je umo¾nit u¾ivatelùm pøihlá¹ení k systému. V metodì handleRequest je
implementován princip pøihlá¹ení WWW-Authenticate.

\subsubsection{Modul LogBook}

Tento modul je základem celého projektu, proto¾e umo¾òuje u¾ivateli ukládat nové záznamy v deníku na server. Pøi svém naètení
vytvoøí tabulku "logbook". V metodì handleRequest na základì URI provádí následující akce:

\begin{itemize}
\item URI "/logbook" - Jako odpovìd na dotaz po¹le celý logbook v CSV formátu získaný z databáze pomocí instance tøídy StorageBackend.
\item URI "/logbook/add" - Pøidá do tabulky "logbook" nový záznam podle CSV dat pøijatých v dotazu.
\item URI "/logbook/remove" - Odstraní z tabulky "logbook" záznam definovaný pomocí ID pøijatého v dotazu.
\item URI "/logbook/call" - Jako odpovìï na dotaz po¹le pouze záznamy o spojeních s konkrétním operátorem urèeným jeho znaèkou v 
tìle dotazu.
\end{itemize}

\subsubsection{Modul DXCC}

Modul DXCC (bì¾í na URI "/dxcc") umo¾òuje získat z volací znaèky bli¾¹í informace o její lokaci. Modul je typu CALLINFO.
Data o jednotlivých prefixech
jsou po startu modulu naètena ze souboru "cty.csv" v CSV formátu. Tento soubor byl získán z TODO.
V metodì handleRequest modul získá z po¾adavku prefix volací
znaèky, vyhledá jej v datech naètených pøi startu a jako odpovìï ode¹le informace o lokaci stanice. Pokud prefix není nalezen,
vrací chybový kód.

\subsubsection{Modul DXCluster}

Modul DXCluster (bì¾ící na URI "/dxcluster") slou¾í k pøipojení k DXClusteru dxspots.com. Modul je typu DXCLUSTER.
Pøi prvním po¾adavku od klienta dojde k pøipojení na DXCluster.
Ve¹kerá data pøijatá z DXClusteru jsou rozparsována a ulo¾ena v CSV formátu. Na ka¾dý
dal¹í klientský po¾adavek odpoví modul daty získanými z DXClusteru. Jde tedy o jistou formu pollingu, kdy si klient
opakovanì ¾ádá o nová data.

\subsubsection{Modul QRZ}

Modul QRZ (bì¾ící na URI "/qrz") je typu CALLINFO umo¾òuje tedy získávat u¾ivateli dal¹í informace o ostatních u¾ivatelích na základì jejich
volací znaèky.K tomuto vyu¾ívá slu¾bu qrz.com. V metodì handleRequest se na základì URI provádí následující akce:

\begin{itemize}
\item URI "/qrz" - Po¹le QRZ serveru po¾adavek pro získání informací o u¾ivateli na základì jeho volací znaèky. Ke komunikaci 
s QRZ serverem je vyu¾íváno XML API, které tento server poskytuje. Odpovìï na po¾adavek je rozparsována pomocí knihovny 
TinyXML a odeslána klientské aplikaci ve formátu CSV.
\item URI "/qrz/register" - Umo¾òuje u¾ivateli zvolení nebo zmìnu hesla pou¾itého pro pøihlá¹ení k QRZ serveru.
\end{itemize}

Komunikace se serverem QRZ je rovnì¾ asynchronní a odpovìï na dotaz na QRZ modul není odeslána ihned.
Je tak tøeba øe¹it problém, kdy klientská aplikace po¹le dotaz na QRZ modul
následovaný dotazem na modul jiný. V tomto pøípadì by mohl být druhý dotaz zpracován pøed prvním a do¹lo by tak k naru¹ení
zpùsobu komunikace dotaz-odpovìï.

Øe¹ením tohoto problému je mo¾nost modulu zastavit doèasnì zpravovávání dal¹ích po¾adavkù od konkrétního klienta, dokud 
nebude vyøízen po¾adavek aktuální. To lze provést zavoláním metody Reply::setAsync(). Jakmile je odpovìï pøipravena
k odeslání, lze ji odeslat metodou Session::sendAsyncReply(). Po zavolání této metody je pak opìt povoleno zpracovávání
dal¹ích po¾adavkù od klienta.

\subsection{Implementace logování}
\label{implementace_logovani}

Logování je implementováno s pou¾itím knihovny Log4cxx vyvíjené Apache Software Foundation a licencované pod licencí
Apache License. Pokud v¹ak není pøi kompilaci knihovna Log4cxx nalezena, je pro logování pou¾it standardní výstup.
Výhodou Pou¾ití Log4cxx je mo¾nost ¹iroké konfigurace logování pomoci konfiguraèního souboru, mo¾nost pøesmìrovat
logování do souboru a tento pak automaticky rotovat na základì jeho velikosti nebo èasu.

Ka¾dá tøída serveru má vlastní statickou instanci tøídy log4cxx::LoggerPtr, kterou vyu¾ívá k logování.
U ka¾dého zápisu do logu se loguje datum a èas, záva¾nost záznamu (Informace, varování, chyba), název modulu a samotný
logovaný záznam.S tandardní výstup pak vypadá napøíklad následovnì:

\begin{verbatim}
2012-03-28 19:12:44,423 INFO  Server: Starting the server
\end{verbatim}

\section{Implementace klientské knihovny}
\label{implementace_knihovna}

Klientská knihovna spojuje serverovou aplikaci se samotným klientským rozhraním.
Klientská knihovna je navr¾ena a implementována
tak, aby ji bylo mo¾no pou¾ít s jakýmkoliv grafickým (pøípadnì i konzolovým) rozhraním. Kvùli pøenositelnosti a
¹ir¹í vyu¾itelnosti je napsána v jazyce C s dùrazem na co nejménì závislostí na jiných knihovnách.

Klientská knihovna je rozdìlena do men¹ích blokù, které budou v této kapitole postupnì popsány.

\subsection{Abstraktní datové typy}

V této podkapitole je popsána implementace abstraktních datových typù po¾itých v klientské knihovnì.

\subsubsection{HAMList - Seznam}

\begin{figure}[h]
\centering
\includegraphics[trim=8cm 8cm 8cm 8cm, scale=0.6]{fig/list.pdf}
\caption{Diagram dvousmìrného seznamu.}
\label{fig:FigureExample}
\end{figure}

HAMList je implementací dvousmìrného seznamu. Základní datové struktury pou¾ité pro definici seznamu jsou
HAMList a HAMListItem:

\begin{verbatim}
typedef struct _HAMListItem {
	void *data;
	struct _HAMListItem *lptr;
	struct _HAMListItem *rptr;
} HAMListItem;

typedef struct _HAMList {
	HAMListItem *first;
	HAMListItem *last;
	HAMListItemDataFree free_func;
} HAMList;
\end{verbatim}

Ka¾dá polo¾ka HAMListItem obsahuje odkaz na svého pøedchùdce (lptr) a následníka (rptr) a samotná data spjatá
s polo¾kou (data). Struktura HAMList obsahuje odkaz na první a poslední polo¾ku a ukazatel na funkci free\_func,
která je pou¾ita pro uvolnìní u¾ivatelských dat z pamìti. Pokud není tato funkce definována, nejsou u¾ivatelská
data pøi uvolòování seznamu z pamìti uvolnìna.

\subsubsection{HAMHashTable - Hashovací tabulka}

\begin{figure}[h]
\centering
\includegraphics[trim=8cm 8cm 8cm 8cm, scale=0.6]{fig/hash.pdf}
\caption{Diagram hash tabulky seznamu.}
\label{fig:FigureExample}
\end{figure}

HAMHashTable je implementací hash tabulky. Základní datové struktury pou¾íté pøi implementaci hash tabulky jsou
HAMHashTableItem a HAMHashTable:

\begin{verbatim}
typedef struct _HAMHashTableItem {
	const void *key;
	void *data;
	unsigned long key_len;
	struct _HAMHashTableItem *next;
} HAMHashTableItem;

typedef struct _HAMHashTable {
	HAMHashTableItem *items[HAM_HASH_LEN];
	unsigned long count;
	HAMHashTableItemDataFree free_func;
} HAMHashTable;
\end{verbatim}

Ka¾dá polo¾ka ulo¾ená v hash tabulce obsahuje svùj klíè (key), jeho délku (key\_len), data svázaná s polo¾kou a ukazatel
na dal¹í polo¾ku. Pøi vlo¾ení nové polo¾ky do tabulky je vypoèten hash jejího klièe pomocí SDBM hashovacího algoritmu.
Na základì hodnoty hashe je ukazatel na polo¾ku ulo¾en do pole polo¾ek items. P

\subsection{Komunikace s klientskou aplikací}
\label{implementace_knihovna_komunikace}

Pro komunikaci s klientskou aplikací je podstatné napojení na její smyèku událostí a mo¾nost pøedávat asynchronnì
výsledky po¾adavkù odeslaných serveru. V této podkapitole jsou popsány øe¹ení obou tìchto problémù

\subsubsection{EventLoop}

Eventloop (neboli smyèka událostí) sdru¾uje metody slou¾ící k napojení na hlavní smyèku
klientské aplikace. Pro správnou funkci klientské
knihovny musí klientská aplikace implementovat v¹echny funkce definované ve struktuøe HAMEventLoopUICallbacks a
pøedat je klientské knihovnì prostøednictvím metody ham\_eventloop\_set\_ui\_callbacks().

Funkce definované ve struktuøe HAMEventLoopUICallbacks jsou pak pou¾ívány dal¹ími èástmi klientské knihovny na
následující èinnosti:

\begin{itemize}
\item timeout\_add - Pøidá do hlavní smyèky programu bì¾ící v klientské aplikaci nový èasocaè. Klientská aplikace
musí vrátit ukazatel na strukturu jednoznaènì identifikující èasovaè a
volat opakovanì funkci pøedánou jakou ukazatel ve zvoleném intervalu.
\item timeout\_remove - Odebere z hlavní smyèky èasovaè na základì jeho ukazatele na strukturu, která jej identifikuje.
\item input\_add - Pøidá do hlavní smyèky klientské aplikace ukazatel na funkci, která je volána kdy¾ jsou k dispozici
nová data na definovaném soketu. Klientská aplikace
musí vrátit ukazatel na strukturu jednoznaènì identifikující tuto událost.
\item input\_remove - Odebere z hlavní smyèky ukazatel na funkci vstupu na
základì ukazatele na strukturu, která jej identifikuje.
\end{itemize}

Díky této abstrakci je tak mo¾no napojit klientskou knihovnu na jakoukoliv smyèku událostí.

\subsubsection{Signály}

Jednotlivé èásti klientské knihovny umo¾òují definovat signály, na které se pak mù¾e klientská aplikace napojit.
Seznam signálù je ulo¾en v hash tabulce, kde klíèem je název signálu a daty seznam funkcí, které jsou zavolány
pokud je signál emitován. K registraci nových signálù slou¾í funkce ham\_signals\_register\_signal().

Klientské aplikaci je umo¾nìno funkcí ham\_signals\_register\_handler() zaregistrovat funkci, která je zavolána
pøi emitování signálu. Funkce musí být ve formátu HAMFetchHandler. Pøi registraci signálu lze rovnì¾ definovat
ukazatel na data, která jsou pøi emitování signálu zpracovávající funkci pøedána. Toho lze vyu¾ít pro udr¾ování
kontextu pøi zpracovávání signálu.


\subsection{Komunikace se serverem}

Tato podkapitola popisuje implementaci komunikace se serverem v klientské knihovnì. Je zde popsáno rozhraní pro
pøipojení k serveru, parser komunikaèního protokolu a pomocné struktury Reply a Request pro reprezetanci odchozích a
pøíchozích paketù.

\subsubsection{Pøipojení k serveru}

Pro pøipojení k serveru je nutné vytvoøit novou instanci struktury Connection funkcí ham\_connection\_new(). Touto funkcí
se definuje adresa a port serveru, u¾ivatelské jméno a heslo. Samotné pøipojení probìhne a¾ po zavolání funkce
ham\_connection\_connect(). Tato funkce vytvoøí nový soket pro pøipojení k serveru a pomocí funkce ham\_eventloop\_input\_add()
pøidá do hlavní smyèky programu ukazatel na funkci pro parsování pøijatých dat.

\subsubsection{Parsování dat}

K parsování dat v klientské knihovnì slou¾í HAMParser. Ten funguje na stejném principu jako RequestParser na stranì serveru.
Parsovaná data jsou ukládána do struktury Reply, která pak pøedána prostøednictvím signálu nebo zpìtného volání (callbacku)
funkci, která po¾adavek na server iniciovala.

\section{Implementace klientské aplikace}
\label{implementace_klient}

Referenèní klientská aplikace byla naprogramována v jazyce C++ s vyu¾itím grafického frameworku Qt. V této kapitole jsou struènì
popsány jednotlivé èásti klientské aplikace, tøídy, které klientskou aplikaci implementují a jejich napojení na klientskou knihovnu.

\subsection{Hlavní okno programu}

V této podkapitole je popsána implementace hlavního okno programu a v¹ech prvkù, které jej tvoøí.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.7]{fig/ham3.png}
\caption{Hlavní okno aplikace.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tøída MainWindow}

Tøída MainWindow reprezentující hlavní okno je také hlavní tøídou klientské aplikace. Po svém vytvoøení zobrazí dialog
pro pøipojení u¾ivatele k serveru. Pomocí metody connectServer() se pak pøihlásí k serveru. Registrovat nový u¾ivatelský
úèet lze metodou registerAccount.

Tøída MainWindow se o úspì¹ném, pøípadnì neúspì¹ném pøihlá¹ení k serveru dozví díky napojení
na patøièné signály klientské knihovny. V této tøídì je také obstarána komunikace mezi jednotlivými prvky tvoøícími hlavní okno
prostøednictvím Qt signálù.

\subsubsection{Tøída LogbookTreeWidget}

Tøídou LogbookTreeWidget je u¾ivateli umo¾nìno zobrazení a editace logu prostøednictvím rozhraní podobného tabulce.
Je implementována nad Qt tøídou QTreeWidget a komunikuje 
se serverovým modulem Logbook prostøednictvím klientské knihovny. Jednotlivé polo¾ky jsou editovatelné a zmìny se pøená¹ejí
na server. Pokud u¾ivatel poklepe na nìkterou z polo¾ek, je zpracován pøíslu¹ný Qt signál a otevøen dialog NewRecordDialog,
ve kterém mù¾e u¾ivatel polo¾ku také editovat.

\subsubsection{Tøída EarthWidget}

Tøída EarthWidget je technologicky nejzajímavìj¹í tøídou klientské aplikace. Umo¾òuje zobrazit zemìkouli promítnutou do roviny i 
formou klasického globusu. Na zemìkouli lze pak zobrazovat znaèky s popisky. Toho je vyu¾ito pro zobrazení polohy právì vysilájících
stanic.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.9]{fig/ham5.png}
\caption{Ukázka mo¾nosti zobrazení zemìkoule.}
\label{fig:FigureExample}
\end{figure}

Pro zobrazení zemìkoule je vyu¾ita aplikace Xplanet. Pøi po¾adavku na pøekreslení okna je spu¹tìn nový proces Xplanet
s po¾adovanými parametry a je mu pøedáno ID widgetu, do kterého má vykreslovat. Znaèky s popisky jsou ulo¾eny do doèasného souboru
a tento soubor je pak naèten programem Xplanet a pou¾it k vykreslení znaèek.
EarthWidget umo¾òuje také pøiblí¾ení na pøeddefinované lokace (napøíklad pøiblí¾ení Evropy) pomocí kontextového menu.

\subsubsection{Tøída DXClusterWidget}

Pomocí tøídy DXClusterWidget je zobrazen seznam aktuálnì vysílajících stanic. Tøída se prostøednictvím klientské knihovny
v pravidelných intervalech dotazuje
serveru na seznam aktuálnì vysílajících stanic a tento pak zobrazuje. Pokud u¾ivatel na nìkterou ze stanic poklepe, otevøe se 
dialog pro pøidání nového záznamu. Seznam stanic je také pøedáván za pomoci Qt signálu tøídì EarthWidget, která pak stanice
vykresluje na mapì.

\subsection{Pøidání nového záznamu a editace}

Nový záznam lze pøidat dvìma zpùsoby. Buï tak lze uèinit pomocí tlaèítka "Add Record" v hlavním oknì programu, nebo poklepáním
na stanici získanou z DXClusteru. Obì mo¾nosti pak vedou k vyvolání dialogu pro pøidání nového záznamu. Stejný dialog je pou¾it
také pro editaci ji¾ existujícího záznamu. Editaci lze vyvolat poklepáním na existující záznam v hlavním oknì programu.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=0.9]{fig/ham4.png}
\caption{Dialog pro pøidání a editaci záznamu.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tøída NewRecordDialog}

Dialog pro pøidání nového záznamu a jeho editaci je implementován v tøídì NewRecordDialog. Dialog se skládá ze dvou èástí:

\begin{itemize}
\item Tabulka zobrazující pøedchozí spojení s pøidávanou stanicí.
\item Formuláø s jednotlivými poli o novì pøidávaném záznamu.
\end{itemize}

Pro implementaci tabulky s pøedchozími spojeními je pou¾ita tøída LogbookTreeWidget. Je tak znovu pou¾it ji¾ jednou existující
kód.

V pøípadì zmìny pole pro zadání volací znaèky (Call sign), je aktualizována tabulka s historií, a u¾ivatel tak vidí pøede¹lá 
spojení s danou stanicí. Také se pomocí klientské knihovny zjistí podrobné informace o zadané stanici a pøedvyplní se patøièná
pole. To zrychluje zadávání nových záznamu. V pøípadì zmìny hodnoty v poli frekvence je na server odeslán po¾adavek o pøeladìní
rádia na zadanou frekvenci.

Po potvrzení dialogu jsou hodnoty v¹ech polí prostøednictvím klientské knihovny pøeneseny na server, kde jsou uchovány.

\subsection{Zobrazení dostupných modulù}

Dialog zobrazující moduly dostupné na server lze spustit prostøednictvím hlavního menu aplikace.

\begin{figure}[h]
\centering
\includegraphics[trim=0cm 0cm 0cm 0cm, scale=1]{fig/ham6.png}
\caption{Dialog pro pøidání a editaci záznamu.}
\label{fig:FigureExample}
\end{figure}

\subsubsection{Tøída NewRecordDialog}

Dialog zobrazující dostupné moduly je implementován tøídou NewRecordDialog. Jedná se o jednoduchou tøídu, která pomocí
klientské knihovny získá ze serveru seznam modulù a zobrazí je formou tabulky vytvoøené díky Qt widget QTreeWidget.


\chapter{Závìr}
Cílem této bakaláøské práce bylo navhrnutí aplikace pro vedení stanièního deníku pro pou¾ití radioamatéry. Dùraz byl kladen zejména
na modularitu návrhu i výsledné implementance. Pro úspì¹né dokonèení práce bylo nejprve potøeba seznámit se s radioamatérským
hnutím a jeho fungováním a aplikacemi a metodami, které souèasní radiamatéøi pou¾ívají. K tomu bylo potøeba zorientovat se v 
radioamatérské technologii a pochopit fungování celého radioamatérského hnutí.
Výsledný návrh se rovnì¾ sna¾í pouèit z problémù souèasných aplikací a svou strukturou zaplnit volné místo mezi aplikacemi
umo¾òujícími vedení stanièního deníku.

Výstupem implementace jsou tøi oddìlené projekty (serverová aplikace, klientská knihovna a grafické u¾ivatelské rozhraní),
které spolu spolupracují a vzájemnì se doplòují.

Serverová aplikace je plnì modulární a umo¾òuje jednoduché pøidávání nových
funkcí pomocí modulù. Splòuje ve¹keré po¾adavky na základní vedení stanièního deníku (pøidávání/editace záznamù, vyhledávání 
informací o ostatních radioamatérech nebo napøíklad ovládání vysílaèky pøipojené k poèítaèi).

\section{Mo¾nosti budoucího roz¹íøení}

